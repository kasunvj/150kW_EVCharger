"use strict";
/* Copyright Sebastian Haas <sebastian$sebastianhaas.info>. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseKcdFile = exports.CanNetwork = exports.Bus = exports.Message = exports.Mux = exports.NodeRef = exports.Signal = exports.Node = exports.BusRefs = exports.J1939 = void 0;
const fs = __importStar(require("fs"));
const xml2js = __importStar(require("xml2js"));
class J1939 {
    constructor(AAC, Function, Vehicle, Identity, Industry, System, Manufacture) {
        this.AAC = AAC;
        this.Function = Function;
        this.Vehicle = Vehicle;
        this.Identity = Identity;
        this.Industry = Industry;
        this.System = System;
        this.Manufacture = Manufacture;
    }
    getName() {
        const name = Buffer.alloc(8);
        name[7] =
            ((this.AAC & 0x1) << 7) |
                ((this.Industry & 0x7) << 4) |
                (this.Vehicle & 0xf);
        name[6] = (this.System << 1) & 0xfe;
        name[5] = this.Function & 0xff;
        name[4] = 0; // function Instance & ECU instance
        name[3] = (this.Manufacture >> 3) & 0xff;
        name[2] = ((this.Manufacture & 0x7) << 5) | ((this.Identity >> 16) & 0x1f);
        name[1] = (this.Identity >> 8) & 0xff;
        name[0] = this.Identity & 0xff;
        return name;
    }
}
exports.J1939 = J1939;
class BusRefs {
    constructor() {
        this.produces = [];
        this.consumes = [];
    }
}
exports.BusRefs = BusRefs;
class Node {
    constructor(id, name, device, j1939) {
        this.id = id;
        this.name = name;
        this.device = device;
        this.j1939 = j1939;
        this.buses = {};
    }
}
exports.Node = Node;
class Signal {
    constructor(name, spn, bitOffset, bitLength, endianess, labels, mux, slope = 1.0, intercept = 0.0, unit = "", type = "unsigned", defaultValue = 0.0, minValue, maxValue) {
        this.name = name;
        this.spn = spn;
        this.bitOffset = bitOffset;
        this.bitLength = bitLength;
        this.endianess = endianess;
        this.labels = labels;
        this.mux = mux;
        this.slope = slope;
        this.intercept = intercept;
        this.unit = unit;
        this.type = type;
        this.defaultValue = defaultValue;
        this.minValue = minValue;
        this.maxValue = maxValue;
    }
}
exports.Signal = Signal;
class NodeRef {
    constructor(id) {
        this.id = id;
    }
}
exports.NodeRef = NodeRef;
class Mux {
    constructor(name, offset, length) {
        this.name = name;
        this.offset = offset;
        this.length = length;
    }
}
exports.Mux = Mux;
class Message {
    constructor(name, id, ext, triggered, length, interval, muxed, mux) {
        this.name = name;
        this.id = id;
        this.ext = ext;
        this.triggered = triggered;
        this.length = length;
        this.interval = interval;
        this.muxed = muxed;
        this.mux = mux;
        this.signals = [];
        this.producers = [];
    }
}
exports.Message = Message;
class Bus {
    constructor() {
        this.messages = [];
    }
}
exports.Bus = Bus;
class CanNetwork {
    constructor() {
        this.nodes = {};
        this.buses = {};
    }
}
exports.CanNetwork = CanNetwork;
// -----------------------------------------------------------------------------
function makeSignalFromXml(xmlSignal, xmlValue, labelset, muxCount) {
    const bitOffset = parseInt(xmlSignal.offset);
    const labelSet = {};
    // add label sets from the database.
    if (Array.isArray(labelset)) {
        const rawLabels = labelset[0]["Label"];
        if (rawLabels != undefined) {
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            rawLabels.forEach((l) => {
                labelSet[l["$"].value] = l["$"].name;
            });
        }
    }
    // add Values from the database
    const rawValue = Array.isArray(xmlValue) ? xmlValue[0]["$"] : undefined;
    const newSignal = new Signal(xmlSignal.name, xmlSignal.spn, bitOffset, parseInt(xmlSignal.length ?? 1), xmlSignal?.endianess ?? "little", labelSet, muxCount, parseFloat(rawValue?.slope ?? 1.0), parseFloat(rawValue?.intercept ?? 0.0), rawValue?.unit ?? "", rawValue?.type ?? "unsigned", parseFloat(rawValue?.defaultValue ?? 0.0), rawValue?.min ? parseFloat(rawValue.min) : undefined, rawValue?.max ? parseFloat(rawValue.max) : undefined);
    return newSignal;
}
function parseKcdFile(file) {
    // Result will be a dictionary describing the whole network
    const network = new CanNetwork();
    const data = fs.readFileSync(file);
    const parser = new xml2js.Parser({ explicitArray: true });
    parser.parseString(data, function (e, parsed) {
        const networkDefinition = parsed["NetworkDefinition"];
        for (const n in networkDefinition["Node"]) {
            const rawNode = networkDefinition["Node"][n]["$"];
            const newNode = new Node(rawNode["id"], rawNode["name"], rawNode["device"], new J1939(rawNode["J1939AAC"], rawNode["J1939Function"], rawNode["J1939Vehicle"], rawNode["J1939IdentityNumber"], rawNode["J1939IndustryGroup"], rawNode["J1939System"], rawNode["J1939ManufacturerCode"]));
            network.nodes[rawNode["id"]] = newNode;
        }
        for (const b in networkDefinition["Bus"]) {
            const rawBus = networkDefinition["Bus"][b]["$"];
            const busName = rawBus["name"];
            const newBus = new Bus();
            const rawBusMessages = networkDefinition["Bus"][b]["Message"];
            for (const messageKey in rawBusMessages) {
                const rawMessage = rawBusMessages[messageKey];
                const message = rawMessage["$"];
                const producers = rawMessage["Producer"];
                const multiplex = rawMessage["Multiplex"];
                const newMessage = new Message(message.name, parseInt(message.id, 16), message.format == "extended", message.triggered == "true", message.length ? parseInt(message.length) : 0, message.interval ? parseInt(message.interval) : 0, multiplex != undefined);
                // Add messages going out and from whom.
                for (const p in producers) {
                    const nodeRefs = producers[p]["NodeRef"];
                    for (const n in nodeRefs) {
                        const nodeRefId = nodeRefs[n]["$"]["id"];
                        newMessage.producers.push(new NodeRef(nodeRefId));
                        // Look up the node by _id_ (number), not name.
                        const nodeDef = network.nodes[nodeRefId];
                        if (nodeDef) {
                            if (nodeDef.buses[busName] == undefined) {
                                nodeDef.buses[busName] = new BusRefs();
                            }
                            nodeDef.buses[busName].produces.push(newMessage.id);
                        }
                    }
                }
                if (!newMessage.interval)
                    newMessage.interval = 0;
                let maxOffset = 0;
                // look for multiplexed messages
                for (const mux in multiplex) {
                    newMessage.mux = {
                        name: multiplex[mux]["$"]["name"],
                        offset: parseInt(multiplex[mux]["$"]["offset"]),
                        length: parseInt(multiplex[mux]["$"]["length"]),
                    };
                    for (const mg in multiplex[mux]["MuxGroup"]) {
                        const muxmsg = multiplex[mux]["MuxGroup"][mg]["$"];
                        for (const s in multiplex[mux]["MuxGroup"][mg]["Signal"]) {
                            const signal = multiplex[mux]["MuxGroup"][mg]["Signal"][s]["$"];
                            const value = multiplex[mux]["MuxGroup"][mg]["Signal"][s]["Value"];
                            const labelset = multiplex[mux]["MuxGroup"][mg]["Signal"][s]["LabelSet"];
                            // Added multiplexor
                            const muxCount = parseInt(muxmsg["count"]);
                            const newSignal = makeSignalFromXml(signal, value, labelset, muxCount);
                            newMessage.signals.push(newSignal);
                            const offset_num = newSignal.bitOffset + newSignal.bitLength;
                            if (offset_num > maxOffset)
                                maxOffset = offset_num;
                        }
                    }
                    // only one muxer supported right now
                    break;
                }
                const signals = networkDefinition["Bus"][b]["Message"][messageKey]["Signal"];
                for (const s in signals) {
                    const signal = signals[s]["$"];
                    const value = signals[s]["Value"];
                    const labelset = signals[s]["LabelSet"];
                    const consumers = signals[s]["Consumer"];
                    const newSignal = makeSignalFromXml(signal, value, labelset, 0);
                    // Add listeners / targets for the message.
                    for (const c in consumers) {
                        for (const n in consumers[c]["NodeRef"]) {
                            const id = consumers[c]["NodeRef"][n]["$"]["id"];
                            if (network.nodes[id]) {
                                if (network.nodes[id].buses[busName] == undefined)
                                    network.nodes[id].buses[busName] = {
                                        produces: [],
                                        consumes: [],
                                    };
                                network.nodes[id].buses[busName].consumes.push({
                                    id: newMessage.id,
                                    signal_name: newSignal.name,
                                });
                            }
                        }
                    }
                    newMessage.signals.push(newSignal);
                    const offset_num = newSignal.bitOffset + newSignal.bitLength;
                    if (offset_num > maxOffset)
                        maxOffset = offset_num;
                }
                // Calculate length based on define signals
                if (!newMessage.length) {
                    newMessage.length = maxOffset / 8;
                    if (maxOffset % 8 > 0)
                        newMessage.length++;
                }
                newBus.messages.push(newMessage);
            }
            network.buses[busName] = newBus;
        }
    });
    // NOTE: Not sure if it is safe here to access result, but I guess parsing the XML file is more or less synchronous.
    return network;
}
exports.parseKcdFile = parseKcdFile;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2Vfa2NkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3BhcnNlX2tjZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FtQkc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUgsdUNBQXlCO0FBQ3pCLCtDQUFpQztBQUVqQyxNQUFhLEtBQUs7SUFDakIsWUFDUSxHQUFXLEVBQ1gsUUFBZ0IsRUFDaEIsT0FBZSxFQUNmLFFBQWdCLEVBQ2hCLFFBQWdCLEVBQ2hCLE1BQWMsRUFDZCxXQUFtQjtRQU5uQixRQUFHLEdBQUgsR0FBRyxDQUFRO1FBQ1gsYUFBUSxHQUFSLFFBQVEsQ0FBUTtRQUNoQixZQUFPLEdBQVAsT0FBTyxDQUFRO1FBQ2YsYUFBUSxHQUFSLFFBQVEsQ0FBUTtRQUNoQixhQUFRLEdBQVIsUUFBUSxDQUFRO1FBQ2hCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxnQkFBVyxHQUFYLFdBQVcsQ0FBUTtJQUN4QixDQUFDO0lBRUosT0FBTztRQUNOLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNOLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDdkIsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUM1QixDQUFDLElBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDdEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDcEMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQy9CLElBQUksQ0FBQyxDQUFD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